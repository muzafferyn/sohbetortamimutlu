
<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Modern Sohbet Odası</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap">
	<style>
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
			font-family: 'Roboto', Arial, sans-serif;
			background: #313338;
			color: #f2f3f5;
		}
		body {
			min-height: 100vh;
			height: 100vh;
			width: 100vw;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}
		.container {
			width: 100vw;
			height: 100vh;
			margin: 0;
			background: #313338;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			box-shadow: none;
			border-radius: 0;
			padding: 0;
			animation: fadeIn 0.7s;
		}
		@keyframes fadeIn {
			from { opacity: 0; transform: translateY(40px); }
			to { opacity: 1; transform: none; }
		}
		#login-screen, #chat-screen {
			width: 100%;
			max-width: 420px;
			margin: auto;
			background: #2b2d31;
			border-radius: 12px;
			box-shadow: 0 4px 32px #0007;
			padding: 36px 28px 24px 28px;
			animation: fadeIn 0.7s;
			position: relative;
			top: 0;
		}
		#login-screen h2 {
			text-align: center;
			margin-bottom: 28px;
			font-size: 2rem;
			font-weight: 700;
			letter-spacing: 1px;
			color: #4e9cff;
			text-shadow: 0 2px 8px #0005;
		}
		#username, #message {
			width: 100%;
			padding: 14px;
			border-radius: 8px;
			border: none;
			margin-bottom: 16px;
			font-size: 1.08rem;
			background: #383a40;
			color: #fff;
			outline: none;
			transition: box-shadow 0.2s;
			box-shadow: 0 2px 8px #0002 inset;
		}
		#username:focus, #message:focus {
			box-shadow: 0 0 0 2px #4e9cff55;
		}
		button {
			background: linear-gradient(90deg, #4e9cff 60%, #3578e5 100%);
			color: #fff;
			border: none;
			border-radius: 8px;
			padding: 13px 0;
			font-size: 1.08rem;
			font-weight: 600;
			width: 100%;
			cursor: pointer;
			transition: background 0.2s, box-shadow 0.2s;
			box-shadow: 0 2px 8px #0002;
			margin-bottom: 8px;
		}
		button:hover {
			background: linear-gradient(90deg, #3578e5 0%, #4e9cff 100%);
			box-shadow: 0 4px 16px #4e9cff33;
		}
		.chat-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
			padding-bottom: 8px;
			border-bottom: 1px solid #4446;
		}
		.logout {
			background: #ff4e4e;
			width: auto;
			padding: 10px 18px;
			font-size: 1rem;
			font-weight: 500;
			border-radius: 6px;
			margin-bottom: 0;
			box-shadow: none;
		}
		.logout:hover {
			background: #e53e3e;
		}
		#chat-screen {
			width: 100vw;
			max-width: 700px;
			min-height: 80vh;
			height: 80vh;
			display: flex;
			flex-direction: column;
			justify-content: flex-end;
			align-items: stretch;
			background: #2b2d31;
			margin: 0 auto;
			box-shadow: 0 4px 32px #0007;
			border-radius: 12px;
			padding: 0 0 18px 0;
		}
		#chat-box {
			background: #23272b;
			border-radius: 10px;
			flex: 1 1 auto;
			min-height: 0;
			max-height: none;
			overflow-y: auto;
			padding: 18px 16px 18px 16px;
			margin: 0 0 12px 0;
			font-size: 1.04rem;
			box-shadow: 0 2px 8px #0002 inset;
			transition: background 0.2s;
			height: 100%;
			display: flex;
			flex-direction: column;
			gap: 8px;
		}
		.message {
			margin-bottom: 0;
			padding: 10px 14px 10px 14px;
			border-radius: 7px;
			background: #383a40;
			box-shadow: 0 1px 4px #0001;
			animation: fadeIn 0.5s;
			word-break: break-word;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.message .user {
			font-weight: bold;
			color: #4e9cff;
			margin-right: 7px;
			font-size: 1.01em;
		}
		.message .time {
			color: #aaa;
			font-size: 0.89em;
			margin-left: auto;
			margin-right: 0;
			float: none;
		}
		#chat-form {
			display: flex;
			gap: 10px;
			padding: 0 16px;
			margin-bottom: 0;
		}
		#message {
			flex: 1;
			margin-bottom: 0;
			background: #23272b;
			border: 1px solid #383a40;
			color: #fff;
		}
		#chat-form button {
			width: 120px;
			margin-bottom: 0;
		}
		@media (max-width: 900px) {
			#chat-screen {
				max-width: 98vw;
			}
		}
		@media (max-width: 600px) {
			.container { padding: 0; }
			#login-screen, #chat-screen {
				padding: 0;
				border-radius: 0;
				box-shadow: none;
				max-width: 100vw;
			}
			#chat-screen {
				min-height: 100vh;
				height: 100vh;
				border-radius: 0;
			}
			#chat-box {
				padding: 10px 4px 10px 4px;
			}
			#chat-form {
				padding: 0 4px;
			}
			#chat-form button {
				width: 70px;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<div id="login-screen">
			<h2>Hoşgeldin!</h2>
			<input type="text" id="username" placeholder="Kullanıcı adını gir" maxlength="20" autofocus>
			<button onclick="login()">Giriş Yap</button>
		</div>
		<div id="chat-screen" style="display:none;">
			<div class="chat-header">
				<span id="welcome"></span>
				<button onclick="logout()" class="logout">Çıkış</button>
			</div>
			<div id="chat-main-area">
				<div id="chat-box"></div>
				<form id="chat-form" autocomplete="off">
					<input type="text" id="message" placeholder="Mesajınızı yazın..." maxlength="200" autocomplete="off">
					<button type="submit">Gönder</button>
				</form>
			</div>
		</div>
	</div>

	<!-- Firebase SDK -->
	<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
	<script>
		const firebaseConfig = {
			apiKey: "AIzaSyCGza0WfU-zLiCleAUkx4wYem248Lvq7U0",
			authDomain: "sohbet-a54ca.firebaseapp.com",
			databaseURL: "https://sohbet-a54ca-default-rtdb.europe-west1.firebasedatabase.app",
			projectId: "sohbet-a54ca",
			storageBucket: "sohbet-a54ca.appspot.com",
			messagingSenderId: "1074571147712",
			appId: "1:1074571147712:web:86b3ebccc2f826fcb67025"
		};
		firebase.initializeApp(firebaseConfig);
		const db = firebase.database();

		// Kullanıcı adı kontrolü ve giriş
		function login() {
			var username = document.getElementById('username').value.trim();
			if(username.length < 2) {
				alert('Kullanıcı adı en az 2 karakter olmalı!');
				return;
			}
			localStorage.setItem('chat_username', username);
			document.getElementById('login-screen').style.display = 'none';
			document.getElementById('chat-screen').style.display = 'block';
			document.getElementById('welcome').innerText = username + ' olarak giriş yaptınız';
			loadMessages();
			setTimeout(function(){ document.getElementById('message').focus(); }, 200);
		}

		function logout() {
			localStorage.removeItem('chat_username');
			location.reload();
		}

		// Mesaj gönderme
		function sendMessage() {
			var msg = document.getElementById('message').value.trim();
			var username = localStorage.getItem('chat_username');
			if(msg.length === 0) return;
			var now = new Date();
			var time = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
			db.ref('messages').push({
				user: username,
				msg: msg,
				time: time
			});
			document.getElementById('message').value = '';
			setTimeout(function(){ document.getElementById('message').focus(); }, 100);
		}

		// Form submit eventini dinle (her zaman çalışsın diye DOMContentLoaded ile bağla)
		document.addEventListener('DOMContentLoaded', function() {
			document.getElementById('chat-form').addEventListener('submit', function(e) {
				e.preventDefault();
				sendMessage();
			});
		});

		// Mesajları çekme ve ekrana yazma
		function loadMessages() {
			db.ref('messages').limitToLast(50).on('value', function(snapshot) {
				var chatBox = document.getElementById('chat-box');
				chatBox.innerHTML = '';
				snapshot.forEach(function(child) {
					var m = child.val();
					var user = escapeHtml(m.user);
					var msg = escapeHtml(m.msg);
					var time = m.time;
					chatBox.innerHTML += `<div class='message'><span class='user'>${user}:</span> ${msg} <span class='time'>${time}</span></div>`;
				});
				chatBox.scrollTop = chatBox.scrollHeight;
			});
		}

		// XSS koruması için
		function escapeHtml(text) {
			var map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
			return text.replace(/[&<>"']/g, function(m) { return map[m]; });
		}

		// Enter ile giriş ve mesaj gönderme
		document.addEventListener('keydown', function(e) {
			if(e.key === 'Enter') {
				if(document.getElementById('login-screen').style.display !== 'none') {
					login();
				}
			}
		});

		// Otomatik giriş
		window.onload = function() {
			var username = localStorage.getItem('chat_username');
			if(username) {
				document.getElementById('login-screen').style.display = 'none';
				document.getElementById('chat-screen').style.display = 'block';
				document.getElementById('welcome').innerText = username + ' olarak giriş yaptınız';
				loadMessages();
				setTimeout(function(){ document.getElementById('message').focus(); }, 200);
			}
		}
	</script>
