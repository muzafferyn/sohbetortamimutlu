<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Chat</title>

<style>
:root{
  --bg:#0b141a;
  --box:#111b21;
  --me:#005c4b;
  --other:#202c33;
  --text:#fff;
}
.light{
  --bg:#f2f2f2;
  --box:#fff;
  --me:#dcf8c6;
  --other:#e4e6eb;
  --text:#000;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui;
}
.chat{
  max-width:420px;
  height:100vh;
  margin:auto;
  background:var(--box);
  display:flex;
  flex-direction:column;
}
.header{
  background:var(--other);
  padding:12px;
  display:flex;
  justify-content:space-between;
}
.messages{
  flex:1;
  padding:10px;
  overflow-y:auto;
}
.msg{
  max-width:80%;
  padding:8px 12px;
  border-radius:12px;
  margin-bottom:8px;
}
.me{background:var(--me);margin-left:auto}
.other{background:var(--other)}
.time{font-size:10px;opacity:.6;text-align:right}
.typing{font-size:12px;opacity:.6;padding:5px}
.input{
  display:flex;
  padding:8px;
  background:var(--other);
}
input{
  flex:1;
  padding:10px;
  border:none;
  border-radius:20px;
}
button{
  margin-left:6px;
  border:none;
  border-radius:50%;
  padding:0 14px;
  cursor:pointer;
}
</style>
</head>
<body>

<div class="chat">
  <div class="header">
    <b>Global Chat</b>
    <button onclick="toggleTheme()">ðŸŒ“</button>
  </div>

  <div class="messages" id="messages"></div>
  <div class="typing" id="typing"></div>

  <div class="input">
    <input id="text" placeholder="Mesaj yaz..." oninput="typingNow()">
    <button onclick="send()">âž¤</button>
  </div>
</div>

<script>
const username = prompt("KullanÄ±cÄ± adÄ±n?") || "Anonim";

/*
 PUBLIC CHAT SERVER
 hiÃ§bir ayar yok
 herkes aynÄ± kanalda
*/
const ws = new WebSocket(
  "wss://socketsbay.com/wss/v2/1/demo/"
);

ws.onmessage = e => {
  const data = JSON.parse(e.data);
  if(data.type === "msg"){
    addMsg(data.user, data.text, data.time);
  }
  if(data.type === "typing"){
    typing.innerText = data.text;
    setTimeout(()=>typing.innerText="",800);
  }
};

function send(){
  const t = text.value.trim();
  if(!t) return;

  ws.send(JSON.stringify({
    type:"msg",
    user: username,
    text: t,
    time: new Date().toLocaleTimeString()
  }));

  text.value="";
}

function typingNow(){
  ws.send(JSON.stringify({
    type:"typing",
    text: username+" yazÄ±yor..."
  }));
}

function addMsg(user, text, time){
  const div = document.createElement("div");
  div.className = "msg " + (user===username?"me":"other");
  div.innerHTML = `<b>${user}</b><br>${text}<div class="time">${time}</div>`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function toggleTheme(){
  document.body.classList.toggle("light");
}
</script>

</body>
</html>
