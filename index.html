

<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Modern Sohbet OdasÄ±</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap">
	<style>
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
			font-family: 'Roboto', Arial, sans-serif;
			background: #23272f;
			color: #f2f3f5;
		}
		body {
			min-height: 100vh;
			height: 100vh;
			width: 100vw;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}
		.container {
			width: 100vw;
			height: 100vh;
			margin: 0;
			background: #23272f;
			display: flex;
			flex-direction: row;
			justify-content: center;
			align-items: stretch;
			box-shadow: none;
			border-radius: 0;
			padding: 0;
			animation: fadeIn 0.7s;
		}
		@keyframes fadeIn {
			from { opacity: 0; transform: translateY(40px); }
			to { opacity: 1; transform: none; }
		}
		#user-list-panel {
			width: 220px;
			background: #181a20;
			border-right: 1.5px solid #23272b;
			display: flex;
			flex-direction: column;
			align-items: stretch;
			padding: 0 0 0 0;
			box-shadow: 2px 0 12px #0002;
			z-index: 2;
			transition: all 0.2s;
		}
		#user-list-panel h3 {
			color: #4e9cff;
			font-size: 1.1rem;
			font-weight: 700;
			margin: 18px 0 10px 0;
			text-align: center;
			letter-spacing: 1px;
		}
		#user-list {
			flex: 1 1 auto;
			overflow-y: auto;
			padding: 0 0 18px 0;
			margin: 0 0 0 0;
			list-style: none;
		}
		#user-list li {
			padding: 10px 18px;
			color: #fff;
			font-size: 1.01rem;
			border-bottom: 1px solid #23272b;
			display: flex;
			align-items: center;
			gap: 8px;
			transition: background 0.2s;
		}
		#user-list li.me {
			background: #2b8cff33;
			color: #4e9cff;
			font-weight: bold;
		}
		#user-list li .user-emoji {
			font-size: 1.2em;
			margin-right: 6px;
		}
		#login-screen, #chat-screen {
			width: 100%;
			max-width: 520px;
			margin: auto;
			background: #2b2d31;
			border-radius: 16px;
			box-shadow: 0 4px 32px #0007;
			padding: 36px 28px 24px 28px;
			animation: fadeIn 0.7s;
			position: relative;
			top: 0;
			display: flex;
			flex-direction: column;
			min-height: 80vh;
			height: 80vh;
		}
		#login-screen h2 {
			text-align: center;
			margin-bottom: 28px;
			font-size: 2rem;
			font-weight: 700;
			letter-spacing: 1px;
			color: #4e9cff;
			text-shadow: 0 2px 8px #0005;
		}
		#username, #message {
			width: 100%;
			padding: 14px;
			border-radius: 10px;
			border: none;
			margin-bottom: 16px;
			font-size: 1.08rem;
			background: #23272b;
			color: #fff;
			outline: none;
			transition: box-shadow 0.2s;
			box-shadow: 0 2px 8px #0002 inset;
		}
		#username:focus, #message:focus {
			box-shadow: 0 0 0 2px #4e9cff55;
		}
		button {
			background: linear-gradient(90deg, #4e9cff 60%, #3578e5 100%);
			color: #fff;
			border: none;
			border-radius: 10px;
			padding: 13px 0;
			font-size: 1.08rem;
			font-weight: 600;
			width: 100%;
			cursor: pointer;
			transition: background 0.2s, box-shadow 0.2s;
			box-shadow: 0 2px 8px #0002;
			margin-bottom: 8px;
		}
		button:hover {
			background: linear-gradient(90deg, #3578e5 0%, #4e9cff 100%);
			box-shadow: 0 4px 16px #4e9cff33;
		}
		.chat-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
			padding-bottom: 8px;
			border-bottom: 1px solid #4446;
		}
		.logout {
			background: #ff4e4e;
			width: auto;
			padding: 10px 18px;
			font-size: 1rem;
			font-weight: 500;
			border-radius: 8px;
			margin-bottom: 0;
			box-shadow: none;
		}
		.logout:hover {
			background: #e53e3e;
		}
		#chat-main-area {
			flex: 1 1 auto;
			display: flex;
			flex-direction: column;
			justify-content: flex-end;
			align-items: stretch;
			min-height: 0;
			height: 100%;
		}
		#chat-box {
			background: #181a20;
			border-radius: 12px;
			flex: 1 1 auto;
			min-height: 0;
			max-height: none;
			overflow-y: auto;
			padding: 18px 16px 18px 16px;
			margin: 0 0 12px 0;
			font-size: 1.04rem;
			box-shadow: 0 2px 8px #0002 inset;
			transition: background 0.2s;
			height: 100%;
			display: flex;
			flex-direction: column;
			gap: 8px;
		}
		.message {
			margin-bottom: 0;
			padding: 10px 16px 10px 16px;
			border-radius: 14px;
			background: #2b2d31;
			box-shadow: 0 1px 4px #0001;
			animation: fadeIn 0.5s;
			word-break: break-word;
			display: flex;
			align-items: center;
			gap: 8px;
			max-width: 70%;
			position: relative;
			min-width: 80px;
		}
		.message.me {
			background: linear-gradient(90deg, #4e9cff 60%, #3578e5 100%);
			color: #fff;
			align-self: flex-end;
			border-bottom-right-radius: 4px;
			border-bottom-left-radius: 14px;
			border-top-right-radius: 14px;
			border-top-left-radius: 14px;
			box-shadow: 0 2px 12px #4e9cff22;
		}
		.message.other {
			background: #23272b;
			color: #f2f3f5;
			align-self: flex-start;
			border-bottom-left-radius: 4px;
			border-bottom-right-radius: 14px;
			border-top-right-radius: 14px;
			border-top-left-radius: 14px;
			box-shadow: 0 2px 12px #0002;
		}
		.message .user {
			font-weight: bold;
			color: #4e9cff;
			margin-right: 7px;
			font-size: 1.01em;
		}
		.message.me .user {
			color: #fff;
		}
		.message .time {
			color: #aaa;
			font-size: 0.89em;
			margin-left: auto;
			margin-right: 0;
			float: none;
		}
		/* Modern mesaj gÃ¶nderme barÄ± */
		#chat-form {
			display: flex;
			gap: 12px;
			padding: 18px 18px 0 18px;
			margin-bottom: 0;
			align-items: center;
			background: #23272b;
			border-radius: 0 0 16px 16px;
			box-shadow: 0 -2px 12px #0002;
			position: relative;
		}
		#message {
			flex: 1;
			margin-bottom: 0;
			background: #181a20;
			border: 1.5px solid #383a40;
			color: #fff;
			border-radius: 8px;
			font-size: 1.12rem;
			padding: 14px 16px;
			outline: none;
			transition: box-shadow 0.2s;
			box-shadow: 0 2px 8px #0002 inset;
		}
		#message:focus {
			box-shadow: 0 0 0 2px #4e9cff55;
		}
		#chat-form .icon-btn, #chat-form .send-btn {
			margin-bottom: 0;
			border-radius: 8px;
			font-size: 1.4em;
			min-width: 48px;
			max-width: 48px;
			height: 48px;
			padding: 0;
			box-shadow: 0 2px 8px #0002;
		}
		#chat-form .send-btn {
			min-width: 100px;
			max-width: 120px;
			font-size: 1.08rem;
			font-weight: 700;
			background: linear-gradient(90deg, #4e9cff 60%, #3578e5 100%);
			color: #fff;
			border: none;
			transition: background 0.2s, box-shadow 0.2s;
		}
		#chat-form .send-btn:hover {
			background: linear-gradient(90deg, #3578e5 0%, #4e9cff 100%);
			box-shadow: 0 4px 16px #4e9cff33;
		}
		@media (max-width: 600px) {
			#chat-form {
				padding: 8px 4px 0 4px;
				border-radius: 0 0 8px 8px;
				gap: 6px;
			}
			#chat-form .icon-btn, #chat-form .send-btn {
				min-width: 38px;
				max-width: 38px;
				height: 38px;
				font-size: 1.1em;
			}
			#chat-form .send-btn {
				min-width: 60px;
				max-width: 80px;
				font-size: 1em;
			}
			#message {
				font-size: 1em;
				padding: 10px 8px;
			}
		}

		/* Mesajlar arasÄ± boÅŸluk ve kutu ayrÄ±mÄ± */
		#chat-box {
			gap: 18px !important;
		}
		.message {
			margin-bottom: 0;
			margin-top: 0;
			margin-right: 0;
			margin-left: 0;
			padding: 13px 18px 13px 18px !important;
			border-radius: 14px;
			background: #2b2d31;
			box-shadow: 0 2px 12px #0002;
			animation: fadeIn 0.5s;
			word-break: break-word;
			display: flex;
			align-items: center;
			gap: 8px;
			max-width: 70%;
			position: relative;
			min-width: 80px;
		}
		.message.me {
			background: linear-gradient(90deg, #4e9cff 60%, #3578e5 100%);
			color: #fff;
			align-self: flex-end;
			border-bottom-right-radius: 4px;
			border-bottom-left-radius: 14px;
			border-top-right-radius: 14px;
			border-top-left-radius: 14px;
			box-shadow: 0 2px 12px #4e9cff22;
		}
		.message.other {
			background: #23272b;
			color: #f2f3f5;
			align-self: flex-start;
			border-bottom-left-radius: 4px;
			border-bottom-right-radius: 14px;
			border-top-right-radius: 14px;
			border-top-left-radius: 14px;
			box-shadow: 0 2px 12px #0002;
		}
		@media (max-width: 1100px) {
			#user-list-panel {
				width: 120px;
				font-size: 0.9em;
			}
			#user-list li {
				padding: 8px 8px;
			}
		}
		@media (max-width: 900px) {
			#chat-screen {
				max-width: 98vw;
			}
			.container {
				flex-direction: column;
			}
			#user-list-panel {
				width: 100vw;
				border-right: none;
				border-bottom: 1.5px solid #23272b;
				flex-direction: row;
				min-height: 60px;
				max-height: 60px;
				overflow-x: auto;
				overflow-y: hidden;
				box-shadow: none;
				padding: 0;
			}
			#user-list {
				display: flex;
				flex-direction: row;
				gap: 0;
				padding: 0 8px;
				margin: 0;
			}
			#user-list li {
				border-bottom: none;
				border-right: 1px solid #23272b;
				padding: 8px 10px;
				min-width: 70px;
				justify-content: center;
			}
		}
		@media (max-width: 600px) {
			.container { padding: 0; }
			#login-screen, #chat-screen {
				padding: 0;
				border-radius: 0;
				box-shadow: none;
				max-width: 100vw;
			}
			#chat-screen {
				min-height: 100vh;
				height: 100vh;
				border-radius: 0;
			}
			#chat-box {
				padding: 10px 4px 10px 4px;
			}
			#chat-form {
				padding: 0 4px;
			}
			#chat-form button {
				width: 70px;
			}
			#user-list-panel {
				min-height: 40px;
				max-height: 40px;
				font-size: 0.8em;
			}
		}
	<style>
    .modal-uyari-bg {
        position: fixed;
        inset: 0;
        background: rgba(10,14,23,0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        animation: fadeIn 0.25s ease;
    }

    .modal-uyari-bg.hide {
        animation: fadeOut 0.3s ease forwards;
    }

    .modal-uyari-box {
        background: #1a1f2e;
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.28);
        padding: 28px 20px 20px;
        border: 1.5px solid #436b9d33;
        width: 100%;
        max-width: 370px;
        text-align: center;
        position: relative;
        margin: 0 10px;
        color: #fff;
        transform: scale(0.95);
        animation: scaleIn 0.25s ease forwards;
    }

    .close-btn {
        position: absolute;
        top: 10px;
        right: 16px;
        background: none;
        border: none;
        font-size: 1.7rem;
        color: #b8c5d6;
        cursor: pointer;
    }

    .close-btn:hover {
        color: #ff6b6b;
    }

    .header {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 14px;
    }

    .header img {
        width: 32px;
        height: 32px;
        margin-right: 10px;
        background: #fff;
        border-radius: 8px;
        object-fit: cover;
    }

    .header span {
        font-size: 1.13rem;
        font-weight: bold;
        color: #ff6b6b;
    }

    .content {
        font-size: 1.01rem;
        color: #b8c5d6;
        line-height: 1.6;
        word-break: break-word;
    }

    @keyframes fadeIn {
        from { opacity: 0 }
        to { opacity: 1 }
    }

    @keyframes fadeOut {
        to { opacity: 0 }
    }

    @keyframes scaleIn {
        to { transform: scale(1) }
    }
</style>

<div class="modal-uyari-bg" id="uyariModal">
    <div class="modal-uyari-box">
        <button class="close-btn" onclick="closeModal()">&times;</button>

        <div class="header">
            <img src="https://w7.pngwing.com/pngs/436/541/png-transparent-rage-comic-internet-meme-know-your-meme-humour-meme-hat-logo-monochrome-thumbnail.png">
            <span>UyarÄ±</span>
        </div>

        <div class="content">
           Åu anda Test aÅŸamasÄ± hata olabilir aQ adam olun kÄ±zlar birÅŸeyler yer misiniz
        </div>
    </div>
</div>

<script>
    const modal = document.getElementById('uyariModal');

    function closeModal() {
        modal.classList.add('hide');
        setTimeout(() => modal.remove(), 300);
    }

    // 2 saniye sonra otomatik kapanÄ±r
    setTimeout(closeModal, 2000);
</script>


</head>
<body>
	<div class="container">
		<div id="navbar" class="navbar-mobile" style="display:none;">
			<button id="navbar-toggle" aria-label="KullanÄ±cÄ±lar" style="background:none;border:none;outline:none;cursor:pointer;padding:12px 18px;">
				<img src="data:image/svg+xml;utf8,<svg width='32' height='32' viewBox='0 0 32 32' fill='none' xmlns='http://www.w3.org/2000/svg'><rect y='7' width='32' height='4' rx='2' fill='white'/><rect y='14' width='32' height='4' rx='2' fill='white'/><rect y='21' width='32' height='4' rx='2' fill='white'/></svg>" width="32" height="32" alt="menu"/>
			</button>
			<span style="color:#4e9cff;font-weight:700;font-size:1.1em;">KullanÄ±cÄ±lar</span>
		</div>
		<div id="user-list-panel" style="display:none;">
			<h3>KullanÄ±cÄ±lar</h3>
			<ul id="user-list"></ul>
		</div>
		<div style="flex:1;display:flex;flex-direction:column;align-items:stretch;justify-content:center;">
			<div id="login-screen">
				<h2>HoÅŸgeldin!</h2>
				<input type="text" id="username" placeholder="KullanÄ±cÄ± adÄ±nÄ± gir" maxlength="20" autofocus>
				<button onclick="login()">GiriÅŸ Yap</button>
			</div>
			<div id="chat-screen" style="display:none;">
				<div class="chat-header">
					<span id="welcome"></span>
					<button onclick="logout()" class="logout">Ã‡Ä±kÄ±ÅŸ</button>
				</div>
				<div id="chat-main-area">
					<div id="chat-box"></div>
					<div id="typing-indicator" style="height:22px;margin:0 0 4px 8px;color:#aaa;font-size:0.98em;display:none;">Birisi yazÄ±yorâ€¦</div>
					<form id="chat-form" autocomplete="off" enctype="multipart/form-data" style="position:relative;">
							<input type="text" id="message" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." maxlength="200" autocomplete="off" style="flex:1;">
							<button type="button" id="plus-btn" class="icon-btn mobile-only" style="display:none;" title="Daha fazla">+</button>
							<button type="button" id="emoji-btn" title="Emoji" class="icon-btn">ğŸ˜€</button>
							<input type="file" id="image-input" accept="image/*" style="display:none;">
							<button type="button" id="image-btn" title="Resim Ekle" class="icon-btn">ğŸ–¼ï¸</button>
							<button type="button" id="audio-btn" title="Ses Kaydet" class="icon-btn">ğŸ¤</button>
							<button type="submit" class="send-btn">GÃ¶nder</button>
					</form>
					<div id="audio-record-status" style="display:none;color:#4e9cff;font-weight:600;margin:6px 0 0 0;">Kaydediliyor...</div>
					<!-- Mobilde aÃ§Ä±lÄ±r panel -->
					<div id="mobile-action-panel" style="display:none;position:absolute;bottom:70px;left:12px;z-index:20;background:#23272b;border-radius:16px;padding:12px 10px;box-shadow:0 2px 16px #0007;min-width:160px;flex-direction:column;gap:8px;">
						<button type="button" id="mobile-emoji-btn" class="icon-btn" style="width:100%;font-size:1.2em;">ğŸ˜€ Emoji</button>
						<button type="button" id="mobile-image-btn" class="icon-btn" style="width:100%;font-size:1.2em;">ğŸ–¼ï¸ FotoÄŸraf</button>
						<button type="button" id="mobile-audio-btn" class="icon-btn" style="width:100%;font-size:1.2em;">ğŸ¤ Ses</button>
					</div>
					<div id="emoji-panel" style="display:none;position:absolute;bottom:70px;left:30px;z-index:10;background:#23272b;border-radius:12px;padding:10px 12px;box-shadow:0 2px 16px #0007;max-width:320px;max-height:180px;overflow:auto;"></div>
					<div id="image-preview" style="display:none;margin:8px 0 0 0;"></div>
				</div>
			</div>
		</div>
	</div>
</style>

<script>
// Responsive ve mobil kullanÄ±cÄ± paneli toggle
function setupResponsiveNavbar() {
  var navbar = document.getElementById('navbar');
  var userPanel = document.getElementById('user-list-panel');
  var navbarToggle = document.getElementById('navbar-toggle');
  function checkMobile() {
    if(window.innerWidth <= 900) {
      navbar.style.display = 'flex';
      userPanel.classList.remove('mobile-visible');
      userPanel.classList.add('mobile-hidden');
    } else {
      navbar.style.display = 'none';
      userPanel.classList.remove('mobile-visible');
      userPanel.classList.remove('mobile-hidden');
      userPanel.style.display = 'flex';
    }
  }
  checkMobile();
  window.addEventListener('resize', checkMobile);
  navbarToggle.addEventListener('click', function(e) {
    e.stopPropagation();
    if(userPanel.classList.contains('mobile-visible')) {
      userPanel.classList.remove('mobile-visible');
      userPanel.classList.add('mobile-hidden');
    } else {
      userPanel.classList.remove('mobile-hidden');
      userPanel.classList.add('mobile-visible');
    }
  });
  // Panel dÄ±ÅŸÄ±na tÄ±klayÄ±nca kapat
  document.addEventListener('click', function(e) {
    if(window.innerWidth <= 900 && userPanel.classList.contains('mobile-visible')) {
      if(!userPanel.contains(e.target) && !navbar.contains(e.target)) {
	userPanel.classList.remove('mobile-visible');
	userPanel.classList.add('mobile-hidden');
      }
    }
  });
}

// Otomatik giriÅŸ ve responsive baÅŸlatÄ±cÄ±
window.onload = function() {
  var username = localStorage.getItem('chat_username');
  if(username) {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('chat-screen').style.display = 'block';
    document.getElementById('welcome').innerText = username + ' olarak giriÅŸ yaptÄ±nÄ±z';
    loadMessages();
    listenTyping();
    setTimeout(function(){ document.getElementById('message').focus(); }, 200);
  }
  setupResponsiveNavbar();
}
</script>

	<!-- Firebase SDK -->
	<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
	<script>
		const firebaseConfig = {
			apiKey: "AIzaSyCGza0WfU-zLiCleAUkx4wYem248Lvq7U0",
			authDomain: "sohbet-a54ca.firebaseapp.com",
			databaseURL: "https://sohbet-a54ca-default-rtdb.firebaseio.com",
			projectId: "sohbet-a54ca",
			storageBucket: "sohbet-a54ca.appspot.com",
			messagingSenderId: "1074571147712",
			appId: "1:1074571147712:web:86b3ebccc2f826fcb67025"
		};
		firebase.initializeApp(firebaseConfig);
		const db = firebase.database();

		// KullanÄ±cÄ± adÄ± kontrolÃ¼ ve giriÅŸ
		function login() {
			var username = document.getElementById('username').value.trim();
			if(username.length < 2) {
				alert('KullanÄ±cÄ± adÄ± en az 2 karakter olmalÄ±!');
				return;
			}
			localStorage.setItem('chat_username', username);
			document.getElementById('login-screen').style.display = 'none';
			document.getElementById('chat-screen').style.display = 'block';
			document.getElementById('welcome').innerText = username + ' olarak giriÅŸ yaptÄ±nÄ±z';
			loadMessages();
			setTimeout(function(){ document.getElementById('message').focus(); }, 200);
		}

		function logout() {
			localStorage.removeItem('chat_username');
			location.reload();
		}

		// Mesaj gÃ¶nderme (gÃ¶rsel destekli, /sil komutlu, gÃ¶rsel anÄ±nda sohbete eklenir)
		function sendMessage() {
			var msg = document.getElementById('message').value.trim();
			var username = localStorage.getItem('chat_username');
			var imageInput = document.getElementById('image-input');
			var file = imageInput.files[0];
			if(msg === '/sil') {
				if(confirm('TÃ¼m sohbeti silmek istediÄŸine emin misin?')) {
					db.ref('messages').remove();
				}
				document.getElementById('message').value = '';
				return;
			}
			if(msg.length === 0 && !file) return;
			var now = new Date();
			var time = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
			if(file && file.type.startsWith('image/')) {
				var storageRef = firebase.storage().ref('chat_images/' + Date.now() + '_' + file.name);
				storageRef.put(file).then(function(snapshot) {
					snapshot.ref.getDownloadURL().then(function(url) {
						db.ref('messages').push({
							user: username,
							msg: msg,
							time: time,
							image: url
						});
						// Mesaj kutusu ve Ã¶nizleme temizle
						document.getElementById('image-input').value = '';
						document.getElementById('image-preview').innerHTML = '';
						document.getElementById('image-preview').style.display = 'none';
						document.getElementById('message').value = '';
						setTimeout(function(){ document.getElementById('message').focus(); }, 100);
					});
				});
				return;
			}
			db.ref('messages').push({
				user: username,
				msg: msg,
				time: time
			});
			document.getElementById('message').value = '';
			setTimeout(function(){ document.getElementById('message').focus(); }, 100);
		}

		// Form submit ve ek buton eventleri
		document.addEventListener('DOMContentLoaded', function() {
			document.getElementById('chat-form').addEventListener('submit', function(e) {
				e.preventDefault();
				sendMessage();
			});
			// Emoji paneli aÃ§/kapat
			document.getElementById('emoji-btn').addEventListener('click', function(e) {
				e.preventDefault();
				toggleEmojiPanel();
			});
			// Resim ekle butonu
			document.getElementById('image-btn').addEventListener('click', function(e) {
				e.preventDefault();
				document.getElementById('image-input').click();
			});
			// Resim seÃ§ildiÄŸinde Ã¶nizleme
			document.getElementById('image-input').addEventListener('change', function(e) {
				showImagePreview(this.files[0]);
			});
		});

		// Emoji panelini gÃ¶ster/gizle
		function toggleEmojiPanel() {
			var panel = document.getElementById('emoji-panel');
			if(panel.style.display === 'none' || panel.style.display === '') {
				panel.innerHTML = emojiList().map(e => `<span style='font-size:1.5em;cursor:pointer;padding:4px;' onclick='addEmojiToMessage("${e}")'>${e}</span>`).join(' ');
				panel.style.display = 'block';
			} else {
				panel.style.display = 'none';
			}
		}

		// Emoji listesini dÃ¶ndÃ¼r
		function emojiList() {
			return ['ğŸ˜€','ğŸ˜','ğŸ˜‚','ğŸ¤£','ğŸ˜…','ğŸ˜Š','ğŸ˜','ğŸ˜˜','ğŸ˜','ğŸ˜¢','ğŸ˜­','ğŸ˜¡','ğŸ˜±','ğŸ‘','ğŸ‘','ğŸ™','ğŸ‘','ğŸ”¥','ğŸ’¯','ğŸ‰','ğŸ¥³','ğŸ˜‡','ğŸ˜œ','ğŸ¤”','ğŸ˜','ğŸ˜¬','ğŸ˜´','ğŸ˜‹','ğŸ˜…','ğŸ˜†','ğŸ˜‰','ğŸ˜ƒ','ğŸ˜„','ğŸ˜š','ğŸ˜™','ğŸ˜—','ğŸ˜','ğŸ˜‘','ğŸ˜¶','ğŸ™„','ğŸ˜¶â€ğŸŒ«ï¸','ğŸ˜®','ğŸ˜²','ğŸ˜³','ğŸ¥º','ğŸ˜¤','ğŸ˜ˆ','ğŸ‘»','ğŸ’€','ğŸ¤–','ğŸ‘½','ğŸ‘¾','ğŸ™ˆ','ğŸ™‰','ğŸ™Š','ğŸ¶','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¨','ğŸ¯','ğŸ¦','ğŸ®','ğŸ·','ğŸ¸','ğŸµ','ğŸ¦„','ğŸ”','ğŸ§','ğŸ¦','ğŸ¤','ğŸ£','ğŸ¥','ğŸ¦†','ğŸ¦…','ğŸ¦‰','ğŸ¦‡','ğŸº','ğŸ—','ğŸ´','ğŸ¦“','ğŸ¦','ğŸ¦§','ğŸ¢','ğŸ','ğŸ¦','ğŸ¦‚','ğŸ¦€','ğŸ¦','ğŸ¦','ğŸ¦‘','ğŸ™','ğŸ¦‘','ğŸ¦','ğŸ¦','ğŸ¦€','ğŸ¡','ğŸ ','ğŸŸ','ğŸ¬','ğŸ³','ğŸ‹','ğŸ¦ˆ','ğŸŠ','ğŸ…','ğŸ†','ğŸ¦“','ğŸ¦','ğŸ¦§','ğŸ˜','ğŸ¦›','ğŸ¦','ğŸª','ğŸ«','ğŸ¦’','ğŸ¦˜','ğŸ¦¥','ğŸ¦¦','ğŸ¦¨','ğŸ¦¡','ğŸ','ğŸ€','ğŸ‡','ğŸ¿ï¸','ğŸ¦”'];
		}

		// Emoji ekle
		function addEmojiToMessage(emoji) {
			var msgInput = document.getElementById('message');
			msgInput.value += emoji;
			msgInput.focus();
			document.getElementById('emoji-panel').style.display = 'none';
		}

		// Resim Ã¶nizleme
		function showImagePreview(file) {
			var preview = document.getElementById('image-preview');
			if(file && file.type.startsWith('image/')) {
				var reader = new FileReader();
				reader.onload = function(e) {
					preview.innerHTML = `<img src='${e.target.result}' style='max-width:120px;max-height:120px;border-radius:8px;box-shadow:0 2px 8px #0005;'> <button onclick='removeImagePreview()' style='background:#ff4e4e;color:#fff;border:none;border-radius:6px;padding:4px 10px;margin-left:8px;cursor:pointer;'>KaldÄ±r</button>`;
					preview.style.display = 'block';
				};
				reader.readAsDataURL(file);
			} else {
				preview.innerHTML = '';
				preview.style.display = 'none';
			}
		}
		function removeImagePreview() {
			document.getElementById('image-input').value = '';
			document.getElementById('image-preview').innerHTML = '';
			document.getElementById('image-preview').style.display = 'none';
		}

		// MesajlarÄ± Ã§ekme ve ekrana yazma (gÃ¶rsel destekli, kendi mesajÄ±n saÄŸda, diÄŸerleri solda)
		function loadMessages() {
			db.ref('messages').limitToLast(50).on('value', function(snapshot) {
				var chatBox = document.getElementById('chat-box');
				chatBox.innerHTML = '';
				var myName = localStorage.getItem('chat_username');
				var users = new Set();
				snapshot.forEach(function(child) {
					var m = child.val();
					var user = escapeHtml(m.user);
					var msg = escapeHtml(m.msg);
					var time = m.time;
					users.add(user);
					var isMe = (user === myName);
					var imageHtml = m.image ? `<br><img src='${m.image}' style='max-width:180px;max-height:180px;border-radius:8px;margin-top:4px;box-shadow:0 2px 8px #0005;'>` : '';
					chatBox.innerHTML += `<div class='message ${isMe ? "me" : "other"}'><span class='user'>${user}${isMe ? " (ben)" : ""}:</span> ${msg}${imageHtml} <span class='time'>${time}</span></div>`;
				});
				chatBox.scrollTop = chatBox.scrollHeight;
				// KullanÄ±cÄ± listesi gÃ¼ncelle
				updateUserList(Array.from(users));
			});
		}
// --- YazÄ±yor bildirimi ---
let typingTimeout = null;
let isTyping = false;
const TYPING_KEY = 'typing';

// Mesaj kutusunda yazÄ±nca
document.addEventListener('DOMContentLoaded', function() {
	var msgInput = document.getElementById('message');
	msgInput.addEventListener('input', function() {
		sendTypingStatus(true);
		clearTimeout(typingTimeout);
		typingTimeout = setTimeout(function() {
			sendTypingStatus(false);
		}, 2000);
	});
});

function sendTypingStatus(status) {
	var username = localStorage.getItem('chat_username');
	db.ref(TYPING_KEY + '/' + username).set(status ? true : null);
}

// DiÄŸer kullanÄ±cÄ±lar yazÄ±yor mu?
function listenTyping() {
	var myName = localStorage.getItem('chat_username');
	db.ref(TYPING_KEY).on('value', function(snapshot) {
		var typingUsers = [];
		snapshot.forEach(function(child) {
			if(child.key !== myName) typingUsers.push(child.key);
		});
		var indicator = document.getElementById('typing-indicator');
		if(typingUsers.length > 0) {
			indicator.innerText = typingUsers.join(', ') + ' yazÄ±yor...';
			indicator.style.display = 'block';
		} else {
			indicator.style.display = 'none';
		}
	});
}

		// KullanÄ±cÄ± listesi panelini gÃ¼ncelle
		function updateUserList(userArr) {
			var myName = localStorage.getItem('chat_username');
			var userList = document.getElementById('user-list');
			userList.innerHTML = '';
			userArr.forEach(function(u) {
				var isMe = (u === myName);
				userList.innerHTML += `<li class='${isMe ? "me" : ""}'><span class='user-emoji'>ğŸ˜€</span> ${escapeHtml(u)}${isMe ? " (ben)" : ""}</li>`;
			});
			// Paneli gÃ¶ster
			document.getElementById('user-list-panel').style.display = userArr.length > 0 ? 'flex' : 'none';
		}

		// XSS korumasÄ± iÃ§in
		function escapeHtml(text) {
			var map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
			return text.replace(/[&<>"']/g, function(m) { return map[m]; });
		}

		// Enter ile giriÅŸ ve mesaj gÃ¶nderme
		document.addEventListener('keydown', function(e) {
			if(e.key === 'Enter') {
				if(document.getElementById('login-screen').style.display !== 'none') {
					login();
				}
			}
		});

		// Otomatik giriÅŸ
		window.onload = function() {
			var username = localStorage.getItem('chat_username');
			if(username) {
				document.getElementById('login-screen').style.display = 'none';
				document.getElementById('chat-screen').style.display = 'block';
				document.getElementById('welcome').innerText = username + ' olarak giriÅŸ yaptÄ±nÄ±z';
				loadMessages();
				listenTyping();
				setTimeout(function(){ document.getElementById('message').focus(); }, 200);
			}
		}
	</script>




